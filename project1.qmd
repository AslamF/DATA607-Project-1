---
title: "Project #1"
format: html
editor: visual
---

## Approach

After carefully reading the assignment I have first determined what it is that needs to be done. I will structure my approach from that understanding. We want to take a player and return the pre-average rating of opponents. We will only consider W, L, and D. Therefore, my first step in this assignment is to take be able to filter through the data-set and find every opponent for the selected player. After determining each player i need to filter the data even further and only return matches that were W, L, or D. With this new data-set I need to take every opponents pre-rating and calculate an average. This is the result we are looking for. What will also be critical is storing each players information in some form of list or using an SQL database have the information for each player accessible.

```{r}
library(tidyverse)
```

## Loading Data and Reading it from github

warn=FALSE was a necessary argument here as i was getting a read error from R. LLM advice was to include this argument because there was an empty line being recognized from the txt file.

```{r}

url <- "https://raw.githubusercontent.com/AslamF/DATA607-Project-1/refs/heads/main/tournamentinfo.txt"

data <- readLines(url, warn=FALSE)

data
```

## Defining Pattern Variables 

This step was critical and I heavily relied upon LLM to assist with regex pattern. With this code we are defining what we are looking for. Because the data came as a text file with extra lines and spacing we really need to clean it up in order to create a usable and readable data frame for our purposes. For example, there are 2 lines, the player name line and player rating line. When each line starts there is a space with no value. There are also characters like " \| " separating values in the file. This all needs to be scraped. Each regex pattern for each variable scraped the data and gets what we need. Pattern name will only give us the player name, pattern points will only give us the points from each round, pattern_opps will give us the opponent number from each round, pattern_state gives us the the state code and pattern_rtg gives us the pre rating value for each player. Post rating is what we are calculating and then providing.

```{r}

pattern_name  <- "(?<=\\|)\\s*[A-Z][A-Z ,.']+(?=\\s*\\|)"
pattern_pts   <- "\\d\\.\\d"
pattern_opps  <- "(?<=[WLD]\\s{1,3})\\d+"
pattern_state <- "^\\s+([A-Z]{2})\\s*\\|"
pattern_rtg   <- "(?<=R:\\s{1,4})\\d+"
```

## Cleaning up the data to be used as a dataframe 

str_extract is a key function which returns a string that matches the regex pattern argument. str_extract(string, pattern)

```{r}
player_lines <- data[str_detect(data, "^\\s+\\d+\\s*\\|")]

rating_lines <- data[str_detect(data, "^\\s+[A-Z]{2}\\s*\\|")]

head(player_lines, 3)
head(rating_lines, 3)


df <- tibble(player_lines, rating_lines) 

dforganized <- df %>%
  mutate(
    player_name  = trimws(str_extract(player_lines, pattern_name)),
    total_points = as.numeric(str_extract(player_lines, pattern_pts)),
    opponents    = str_extract_all(player_lines, pattern_opps),
    player_state = trimws(str_extract(rating_lines, pattern_state, group = 1)),
    pre_rating   = as.numeric(str_extract(rating_lines, pattern_rtg)))
  
print(dforganized)
```

## Calculating Avg Pre Rating

```{r}
 finaldf <- dforganized %>%
    mutate(
    avgPreRating = sapply(opponents, function(opps) {
      opponent_index   <- as.integer(opps)
      opponent_ratings <- pre_rating[opponent_index]
      round(mean(opponent_ratings, na.rm = TRUE))
    })
  ) %>%
  select(player_name, player_state, total_points, pre_rating, avgPreRating)
 
 print(finaldf)

```

## Exporting to CV

```{r}
write_csv(finaldf, "results.csv")

check <- read_csv("results.csv")
print(check)
```

## Conclusion 

The hardest part of this assignment was converting the txt file into a readable and usable format in R. LLM was extremely helpful in understanding regex patterns to parse through the txt and obtain the numbers and strings we needed to use, getting rid of empty spaces and non-usable characters such as "\|". A-lot of this was data processing and a unique way of handling a new type of data.
